
<html>
<head>
<script src='External_OTS_Standards.js'></script>
<meta name="viewport" content="width=device-width, initial-scale=1"><link href="External_OTS_Standards.css" rel="stylesheet"></head>
</head>

<div class="report">
	<div class="component"><span class="componentTitle">Demo Report</span></div>
<div class="component" id="chart1"></div>
<div class="component" id="chart2"></div>
<div class="component" id="table1"></div>
</div>

<script>
//  getting session  parameters
	function getParams() { 
			var locationSearch = (location.search).split('+').join(' ');
			var arr = (locationSearch.replace('?','')).split('&');
			var  params = [];
			for(i=0;i<arr.length;i++)
			{
		   		var p = arr[i].split('=');
			 	params.push(p);
			}
		const paramObj = params.reduce((paramObj, [ key, value ]) => { return { ...paramObj,[key]: value };},{});
		return paramObj;
	}
 	const params =  getParams();
 	console.log(params);

(function(){
        let origin = location.origin || (location.protocol + '//' + location.host);
        window.onload = () => {
            const data = JSON.stringify({name:'stdappsrequestdata', data :`SELECT SERIESNAME, CATEGORY, VALUE FROM STDTESTRDS WHERE SERIESNAME = '${params.personID}'`});
            window.parent.postMessage(data,'*');
        };
})(window);

window.addEventListener('message', function(event) {
    console.log('called in child iFrame...@@@');
    if(event && event.data) {
        let {name, data} = JSON.parse(event.data);
        if(name === 'stdappsdata') {
				console.log('>>>>>>>>>>>>>>>>>>>>>>>>>>>>> !!!!',event.data);
				console.log('>>>>>>>>>>>',data);

				let ChartData1 = data.map(a=> {
					let x= {};
					  x.seriesName=a.seriesname;
					  x.category = a.category;
					  x.value=a.value;
					  return x
					});

				let Criteria1 =
				  [
					{
					  "seriesName": params.personID,
					  "color": "",
					  "zIndex": 0,
					  "yAxisID": 0
					}
				  ];
				  
				let rawModel1 = {
				  "plotLineValue":'Rejected',
				  "plotLineStyle":'dot',
				  "chartType":'',
				  "container": 'chart1',
				  "chartTitle": 'Line Chart',
				  "subtitle": '',
				  "chartData": ChartData1,
				  "legend": true,
				  "clickableLegends": false,
				  "stacking": true,
				  "stackingType": 'normal',
				  "seriesSpecifications": Criteria1,
				  "xAxisTitle": "",
				  "minThreshold":'',
				  "maxThreshold":undefined,
				  "yAxis": [{
					"title": "Count",
					"decimal": true,
					"minValue": "",
					"type": 'unit',
					"opposite":''
					
				  }]
				}

				let Criteria2 =
				  [
					{
					  "chartType":'column',
					  "seriesName": params.personID,
					  "color": "",
					  "zIndex": 0,
					  "yAxisID": 0
				  
					}  
				  ];
				  
					let rawModel2 = {
					  "plotLineValue":'Rejected',
					  "plotLineStyle":'dot',
					  "chartType":'',
					  "container": 'chart2',
					  "chartTitle": 'Column Chart',
					  "subtitle": '',
					  "chartData": ChartData1,
					  "legend": true,
					  "clickableLegends": false,
					  "stacking": true,
					  "stackingType": 'normal',
					  "seriesSpecifications": Criteria2,
					  "xAxisTitle": "",
					  "minThreshold":'',
					  "maxThreshold":undefined,
					  "yAxis": [{
						"title": "Value",
						"decimal": true,
						"minValue": "",
						"type": 'currency',
						"opposite":''
						
					  }]
					}


				let ColumnDetails = [{
					"ID": 1,
					"name": 'seriesName',
					"field": 'seriesName',
					"type": ''
				  },
				  {
					"ID": 2,
					"name": 'category',
					"field": 'category',
					"type": ''
				  },
				  {
					"ID": 1,
					"name": 'value',
					"field": 'value',
					"type": 'currency'
				  },
				];

			let rawModelT = {
			  "container": 'table1',
			  "data": ChartData1,
			  "columns": ColumnDetails,
			  "paginationSize":"2",
			  "linkedChartContainer":"chart2"
			};


				let config = {
				  "chart": [{				
					"rawModel": rawModel1
				  },{	
					"rawModel": rawModel2
				  }],
				  "table": [{	
					"rawModel": rawModelT
				  }],
				  "currencyCode": 'INR',
				  "unit": 'Disputes'
				};

				console.log(config);
				createContent(config);
			}
		}   
	});
</script>
</html>